<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}DataCollect{% endblock %}</title>

    <!-- Favicon -->
    <link
      rel="icon"
      href="{{ url_for('static', filename='icons/icon-192.png') }}"
      type="image/png"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />

    <!-- Custom styles -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />

    <!-- PWA Manifest -->
    <link
      rel="manifest"
      href="{{ url_for('static', filename='manifest.json') }}"
    />
    <meta name="theme-color" content="#2a8c82" />
  </head>

  <body class="d-flex flex-column min-vh-100">
    <!-- Page Content -->
    <main class="flex-grow-1">
      <div class="container-fluid">{% block content %}{% endblock %}</div>
    </main>

    <!-- Footer -->
    <footer class="text-center py-3 mt-auto border-top bg-light">
      <small>
        &copy; Developed by Okello Raymond <br />
        0778412136
      </small>
    </footer>

    <!-- ================== JS SECTION ================== -->

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Global App Logic -->
    <script src="{{ url_for('static', filename='app.js') }}"></script>

    <!-- Wizard & Form Logic (Validation, Fertility %, Confirm Modal) -->
    <script src="{{ url_for('static', filename='wizard.js') }}"></script>

    <!-- Service Worker Registration -->
    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("/sw.js")
          .then((reg) => console.log("Service Worker registered", reg))
          .catch((err) => console.error("SW failed", err));

        navigator.serviceWorker.ready.then((reg) => {
          if ("sync" in reg) {
            reg.sync
              .register("sync-forms")
              .then(() => console.log("Background sync registered"))
              .catch((err) => console.error("Sync registration failed:", err));
          }
        });
      }
    </script>

    <!-- ================== GLOBAL CONFIRM SUBMIT MODAL ================== -->
    <div
      class="modal fade"
      id="confirmSubmitModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content rounded-4">
          <div class="modal-header bg-success text-white rounded-top-4">
            <h5 class="modal-title">Confirm Submission</h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            Are you sure all form details are correct? <br />
            Click <strong>“Yes, Submit”</strong> to confirm and send your entry.
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-outline-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" id="confirmSubmitBtn" class="btn btn-success">
              Yes, Submit
            </button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
